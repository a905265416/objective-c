# 第七条：在对象内部尽量直接访问实例变量

在对象之外访问实例变量时，总是应该通过属性来做，然而在对象内部访问实例变量时又该如何呢？

**建议：**

在读取实例变量的时候采用直接访问的形式，而在设置实例变量的时候通过属性来做。

## 类内使用 self.xxx 和 _xxx 的区别

1、_xxx 不经过“方法派发”，速度更快

2、直接访问实例变量时，不会调用其“设置方法”，这就绕过了为相关属性所定义的“内存管理语义”。

比如，在 ARC 下 直接访问一个声明为 copy 的属性，那么并不会拷贝该属性，只会保留新值并释放旧值。

3、如果直接访问实例变量，那么不会触发“键值观测（KVO）”这样做是否会产生问题，还取决于具体的对象行为。

4、访问 _xxx 不经过 setter/getter 方法，无法断点。



## 什么时候使用 _xxx

1、折中方案，读的时候使用 _xxx，写的时候使用 self.xxx

2、父类的 init 和 dealloc 尽量使用 _xxx 来访问，因为如果子类覆盖了 setter 方法，并做了某些非空检查，那么父类初始化的时候会调用子类的 setter 方法，由于是在 init/dealloc，参数可能是空的，此时报错

3、如果实例变量在父类中声明，那么子类只能使用 self.xxx 来访问属性

4、使用懒加载的情况下，必须通过 self.xxx 来访问属性，否则初始化失败

```objective-c
- (NSString *)str
{
  if (!_str) {
    _str = [[NSString alloc] init];
  }
  return _str;
}
```



